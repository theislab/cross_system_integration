# Run selected params (worked well or for comparison) for presentation plots & eval
seml:
  executable: /lustre/groups/ml01/code/karin.hrovatin/cross_species_prediction/notebooks/eval/run_seml.py
  name: csp_eval
  output_dir: /lustre/groups/ml01/workspace/karin.hrovatin/data/cross_species_prediction/eval/presFeb23/logs # CHANGE! OUT!
  project_root_dir:  /lustre/groups/ml01/code/karin.hrovatin/cross_species_prediction/notebooks/eval
  conda_environment: csp
  
slurm:
  sbatch_options_template: GPU
  sbatch_options:
    mem: 10G          # memory, set to 32, for pancreas this could be 10Gb
    cpus-per-task: 4  # num cores, set to 4
    time: 0-02:00     # max time, D-HH:MM, set to 0-08:00, for pancreas this could be 1h
    nice: 10000

fixed:
  path_save: /lustre/groups/ml01/workspace/karin.hrovatin/data/cross_species_prediction/eval/presFeb23/ # CHANGE! OUT!
  system_key: system
  system_translate: 1
  max_epochs: 70
  epochs_detail_plot: 20
  # Model params
  system_decoders: 0
       
  
grid:
  seed_num:
    type: choice
    options:
      - 1
      - 2
      - 3
      - 4
      - 5 
        
pancreas:
  fixed:
    path_adata: /lustre/groups/ml01/workspace/karin.hrovatin/data/cross_species_prediction/pancreas_example/combined_orthologues.h5ad
    group_key: cell_type_final
    group_translate: beta
    batch_key: study_sample
  grid:
    eval_type:
      type: choice
      options:
        - translation
        - integration
  klw_opt:
    fixed:
      params_opt: kl_weight
    grid:
      kl_weight:
        type: choice
        options:
          - 1
          - 1.5
          - 2
          - 5
          - 10
          - 20 
  vamp_opt:
    fixed:
      params_opt: vamp
      prior: vamp
    grid:
      n_prior_components:
        type: choice
        options:
          - 5
          - 10
          - 50
          - 100
          - 500
          - 1000
  vamp_sys_opt:
    fixed:
      params_opt: vamp_sys
      prior: vamp
      n_prior_components: 50
    grid:
      prior_components_system:
        type: choice
        options:
          - 0
          - 1           
  zdcw_opt:
    fixed:
      z_dist_metric: MSE 
      params_opt: z_distance_cycle_weight
    grid:
      z_distance_cycle_weight:
        type: choice
        options:
          - 1
          - 2
          - 5 
          - 10
          - 50
          - 100
  zdcw_opt_std:
    fixed:
      z_dist_metric: MSE_standard 
      params_opt: z_distance_cycle_weight_std
    grid:
      z_distance_cycle_weight:
        type: choice
        options:
          - 1
          - 2
          - 5 
          - 10
          - 50
          - 100
  zdcw_opt_kl:
    fixed:
      z_dist_metric: KL
      params_opt: z_distance_cycle_weight_kl
    grid:
      z_distance_cycle_weight:
        type: choice
        options:
          - 1
          - 2
          - 5 
          - 10
          - 50
          - 100
  zdcw_opt_nll:
    fixed:
      z_dist_metric: NLL
      params_opt: z_distance_cycle_weight_nll
    grid:
      z_distance_cycle_weight:
        type: choice
        options:
          - 1
          - 2
          - 5 
          - 10
          - 50
          - 100            
  rmw_trans_opt:
    fixed:
      eval_type: translation
      mixup_alpha: 0.4
      params_opt: reconstruction_mixup_weight
    grid:
      reconstruction_mixup_weight:
        type: choice
        options:
          - 1
          - 2
          - 5
          - 10
          - 50
          - 100          
  scvi:
    fixed:
      eval_type: integration
      model: scvi
      params_opt: scvi
  ovm_sf:
    fixed:
      out_var_mode: sample_feature
      params_opt: out_var_mode      
    
pancreas_tabula:
  fixed:
    path_adata: /lustre/groups/ml01/workspace/karin.hrovatin/data/cross_species_prediction/pancreas_example/combined_tabula_orthologues.h5ad
    group_key: cell_type
    group_translate: type B pancreatic cell
    batch_key: batch
    cells_eval: eval_cells
    genes_eval: eval_genes
    eval_type: translation
  vamp_opt:
    fixed:
      params_opt: vamp
      prior: vamp
    grid:
      n_prior_components:
        type: choice
        options:
          - 50
          - 100
          - 500
          - 1000
          - 5000
          - 10000
  vamp_sys_opt:
    fixed:
      params_opt: vamp_sys
      prior: vamp
      n_prior_components: 500
    grid:
      prior_components_system:
        type: choice
        options:
          - 0
          - 1       
  rmw_opt:
    fixed:
      mixup_alpha: 0.4
      params_opt: reconstruction_mixup_weight
    grid:
      reconstruction_mixup_weight:
        type: choice
        options:
          - 1
          - 2
          - 5
          - 10
          - 50
          - 100  
  size_opt:
    fixed:
      params_opt: nn_size  
    grid:
      n_layers:
        type: choice
        options:
          - 4
      n_hidden:
        type: choice
        options:
          - 512
  klw_opt:
    fixed:
      params_opt: kl_weight
    grid:
      kl_weight:
        type: choice
        options:
          - 1
          - 1.5
          - 2
          - 5
          - 10
          - 20 
  ovm_sf:
    fixed:
      out_var_mode: sample_feature
      params_opt: out_var_mode              