# Seml evaluation of lr on pancreas and pancreas+tabula data
seml:
  executable: /lustre/groups/ml01/code/karin.hrovatin/cross_species_prediction/notebooks/eval/run_seml.py
  name: csp_eval
  output_dir: /lustre/groups/ml01/workspace/karin.hrovatin/data/cross_species_prediction/eval/lr/logs # CHANGE! OUT!
  project_root_dir:  /lustre/groups/ml01/code/karin.hrovatin/cross_species_prediction/notebooks/eval
  conda_environment: csp
  
slurm:
  sbatch_options_template: GPU
  sbatch_options:
    mem: 10G          # memory, set to 32, for pancreas this could be 10Gb
    cpus-per-task: 4  # num cores, set to 4
    time: 0-03:00     # max time, D-HH:MM
    nice: 10000

fixed:
  path_save: /lustre/groups/ml01/workspace/karin.hrovatin/data/cross_species_prediction/eval/lr/ # CHANGE! OUT!
  system_key: system
  system_translate: 1
  max_epochs: 150
  epochs_detail_plot: 20
  eval_type: translation
  # Model params
  system_decoders: 0
  # LR param
  optimizer: AdamW
  reduce_lr_on_plateau: 1
       
grid:
  name:
    type: choice
    options:
      - r1
      - r2
      - r3
#       - r4
#       - r5
  lr:
    type: choice
    options:
      - 0.01
      - 0.001
  lr_patience:
    type: choice
    options:
      - 5
      - 10
  lr_factor:
    type: choice
    options:
      - 0.1
      - 0.5
  lr_min:
    type: choice
    options:
#       - 1e-6
      - 1e-7
     
pancreas:
  fixed:
    path_adata: /lustre/groups/ml01/workspace/karin.hrovatin/data/cross_species_prediction/pancreas_example/combined_orthologues.h5ad
    group_key: cell_type_final
    group_translate: beta
    batch_key: study_sample
    params_opt: pancreas
  # Different datasets need different lr threshold as this is relative to full loss which has different total value and variation
  grid:
    lr_threshold:
      type: choice
      options:
        - -0.005
        - -0.01
        - -0.05  
    
pancreas_tabula:
  fixed:
    path_adata: /lustre/groups/ml01/workspace/karin.hrovatin/data/cross_species_prediction/pancreas_example/combined_tabula_orthologues.h5ad
    group_key: cell_type
    group_translate: type B pancreatic cell
    batch_key: batch
    cells_eval: eval_cells
    genes_eval: eval_genes
    params_opt: pancreas+tabula
  grid:
    lr_threshold:
      type: choice
      options:
        - -0.001
        - -0.005
        - -0.01      